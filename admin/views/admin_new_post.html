{{ template "admin_header.html" .}}

{{ template "tinymde_component.html" .}}

<header>
    <h2>Criar Novo Post</h2>
</header>

<form action="/admin/{{.subdomain}}/post/salvar" method="POST">
    <label for="title" class="width">
        Título
        <input type="text" id="title" name="title" required>
    </label>

    <label for="tags" class="width">
        Tags
        <input type="text" id="tags" name="tags">
    </label>

    <label for="txt_content" class="width">
        Conteúdo (<a href="https://markdown.net.br/referencia-rapida/" target="_blank">Markdown</a>)
        <small>Dica: Use Ctrl+R para visualizar o markdown renderizado • F11 para tela cheia</small>
    </label>
    <section style="background-color: #ffffff;">
        <textarea id="txt_content" name="content" rows="20" required style="font-family: 'Courier New', monospace; white-space: pre-wrap;"> </textarea>
    </section>
    <input type="hidden" id="draft" name="draft" value="true">
    <section>
        <button type="submit" name="action" value="save_draft">Salvar Rascunho</button>
        <button type="submit" name="action" value="publish">Publicar</button>
        <button type="button" onclick="window.location.href='/admin/{{.subdomain}}/posts'">Cancelar</button>
    </section>
</form>

<script>
    // Inicializar TinyMDE com auto-save habilitado (é um novo post, então é sempre rascunho)
    const tinyMDEManager = new TinyMDEManager({
        textareaId: 'txt_content',
        autoSave: true,
        autoSaveUrl: '/admin/{{.subdomain}}/post/autosave',
        autoSaveKey: 'new_post'
    });

    document.querySelector('button[value="save_draft"]').addEventListener('click', function () {
        document.getElementById('draft').value = 'true';
    });

    document.querySelector('button[value="publish"]').addEventListener('click', function () {
        document.getElementById('draft').value = 'false';
    });
</script>

{{ template "admin_footer.html" .}}
