{{ template "admin_header.html" .}}

{{ template "tinymde_component.html" .}}

<header>
    <h2>Criar Novo Post</h2>
</header>

{{ if .replyTo }}
<section style="background: #f0f0f0; padding: 1rem; margin-bottom: 1rem; border-left: 4px solid #007bff;">
    <p><strong>Em resposta a:</strong>
    {{ if .replyToBlog }}
    <a href="/@/{{.replyToBlog.Subdomain}}/{{.replyTo.Slug}}" target="_blank">{{.replyTo.Title}}</a>
    {{ else }}
    <a href="/@/{{.blog.Subdomain}}/{{.replyTo.Slug}}" target="_blank">{{.replyTo.Title}}</a>
    {{ end }}
    </p>
</section>
{{ end }}

<form action="/admin/{{.subdomain}}/post/salvar" method="POST">
    {{ if .replyTo }}
    <input type="hidden" name="reply_to_id" value="{{.replyTo.ID}}">
    {{ end }}

    <label for="title" class="width">
        Título
        <input type="text" id="title" name="title" required>
    </label>

    <label for="tags" class="width">
        Tags
        <input type="text" id="tags" name="tags">
    </label>

    <label for="txt_content" class="width">
        Conteúdo (<a href="https://markdown.net.br/referencia-rapida/" target="_blank">Markdown</a>)
        <textarea id="txt_content" name="content" rows="20" required></textarea>
    </label>
    <input type="hidden" id="draft" name="draft" value="true">
    <section>
        <button type="submit" name="action" value="save_draft">Salvar Rascunho</button>
        <button type="submit" name="action" value="publish">Publicar</button>
        <button type="button" onclick="window.location.href='/admin/{{.subdomain}}/posts'">Cancelar</button>
    </section>
</form>

<script>
    // Inicializar EasyMDE com auto-save habilitado (é um novo post, então é sempre rascunho)
    const easyMDEManager = new EasyMDEManager({
        textareaId: 'txt_content',
        autoSaveUrl: '/admin/{{.subdomain}}/post/autosave'
    });

    document.querySelector('button[value="save_draft"]').addEventListener('click', function () {
        document.getElementById('draft').value = 'true';
    });

    document.querySelector('button[value="publish"]').addEventListener('click', function () {
        document.getElementById('draft').value = 'false';
    });
</script>

{{ template "admin_footer.html" .}}
